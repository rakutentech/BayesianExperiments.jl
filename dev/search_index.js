var documenterSearchIndex = {"docs":
[{"location":"examples_conjugate/#Examples:-Conjugate-Models","page":"Examples: Conjugate Models","title":"Examples: Conjugate Models","text":"","category":"section"},{"location":"examples_conjugate/#Example:-Two-Models","page":"Examples: Conjugate Models","title":"Example: Two Models","text":"","category":"section"},{"location":"examples_conjugate/","page":"Examples: Conjugate Models","title":"Examples: Conjugate Models","text":"A basic example showing an experiment with two models.","category":"page"},{"location":"examples_conjugate/","page":"Examples: Conjugate Models","title":"Examples: Conjugate Models","text":"using BayesianExperiments\n\n# Generate sample data\nn = 1000\ndataA = rand(Bernoulli(0.15), n)\ndataB = rand(Bernoulli(0.16), n)\n\n# Define the models\nmodelA = ConjugateBernoulli(1, 1)\nmodelB = ConjugateBernoulli(1, 1)\n\n# Choose the stopping rule that we will use for making decision\nstoppingrule = ExpectedLossThresh(0.0002)\n\n# Setup the experiment by specifying models and the stopping rule\nexperiment = ExperimentAB([modelA, modelB], stoppingrule)\n\n# Calculate the statistics from our sample data\nstatsA = BernoulliStatistics(dataA)\nstatsB = BernoulliStatistics(dataB)\n\n# Update the models in the experiment with the newly created statistics\nupdate!(experiment, [statsA, statsB])\n\n# Calculate the metric (expected loss in this case) of each model \nwinner_index, expected_losses = metrics(experiment)\n\n# Or, we can directly find the winning model in the experiment \nwinner = decide!(experiment)","category":"page"},{"location":"examples_conjugate/#Example:-Three-Models","page":"Examples: Conjugate Models","title":"Example: Three Models","text":"","category":"section"},{"location":"examples_conjugate/","page":"Examples: Conjugate Models","title":"Examples: Conjugate Models","text":"Similar to the two models cases, but now we have three models.","category":"page"},{"location":"examples_conjugate/","page":"Examples: Conjugate Models","title":"Examples: Conjugate Models","text":"using BayesianExperiments\n\n# Generate sample data\nn = 1000\ndataA = rand(Bernoulli(0.150), n)\ndataB = rand(Bernoulli(0.145), n)\ndataC = rand(Bernoulli(0.180), n)\n\n# Define the models\nmodelA = ConjugateBernoulli(1, 1)\nmodelB = ConjugateBernoulli(1, 1)\nmodelC = ConjugateBernoulli(1, 1)\n\n# Choose the stopping rule\nstoppingrule = ProbabilityBeatAllThresh(0.99)\n\n# Setup the experiment\nexperiment = ExperimentABN([modelA, modelB, modelC], stoppingrule)\n\n# Calculate the statistics from our sample data\nstatsA = BernoulliStatistics(dataA)\nstatsB = BernoulliStatistics(dataB)\nstatsC = BernoulliStatistics(dataC)\n\n# Update the model in the experiment with the newly created statistics\nupdate!(experiment, [statsA, statsB, statsC])\n\n# Calculate the metric (expected loss in this case) of each model \nwinner_index, expected_losses = metrics(experiment)\n\n# Or, we can directly find the winning model in the experiment \nwinner = decide!(experiment)","category":"page"},{"location":"examples_conjugate/#Example:-Chained-Models","page":"Examples: Conjugate Models","title":"Example: Chained Models","text":"","category":"section"},{"location":"examples_conjugate/","page":"Examples: Conjugate Models","title":"Examples: Conjugate Models","text":"We have a chained model with ConjugateBernoulli and ConjugateLogNormal. A common use case is when we want to use revenue per visitor as the metric. We need to model distributions of both the conversion rate and revenue.  ","category":"page"},{"location":"examples_conjugate/","page":"Examples: Conjugate Models","title":"Examples: Conjugate Models","text":"using BayesianExperiments\n\n# Generate sample data\nn = 1000\ndataA1 = rand(Bernoulli(0.050), n)\ndataA2 = rand(LogNormal(1.0, 1.0), n)\ndataB1 = rand(Bernoulli(0.060), n)\ndataB2 = rand(LogNormal(1.0, 1.0), n)\n\n# Calculate the statistics from our sample data\nstatsA1 = BernoulliStatistics(dataA1)\nstatsA2 = LogNormalStatistics(dataA2)\nstatsB1 = BernoulliStatistics(dataB1)\nstatsB2 = LogNormalStatistics(dataB2)\n\n# Setup the experiment\nmodelA = ChainedModel(\n    [ConjugateBernoulli(1, 1), ConjugateLogNormal(0.0, 1.0, 0.001, 0.001)],\n    [MultiplyOperator()]\n)\nmodelB = ChainedModel(\n    [ConjugateBernoulli(1, 1), ConjugateLogNormal(0.0, 1.0, 0.001, 0.001)],\n    [MultiplyOperator()]\n)\n\n# Choose the stopping rule\nstoppingrule = ExpectedLossThresh(0.001)\n\n# Setup the experiment\nexperiment = ExperimentAB([modelA, modelB], stoppingrule)\n\n# Update the model in the experiment with the newly created statistics\nupdate!(experiment, [[statsA1, statsA2], [statsB1, statsB2]])\n\n# Calculate the metric (expected loss in this case) of each model \nwinner_index, expected_losses = metrics(experiment)\n\n# Or, we can directly find the winning model in the experiment \nwinner = decide!(experiment)","category":"page"},{"location":"examples_conjugate/#Example:-Power-Analysis","page":"Examples: Conjugate Models","title":"Example: Power Analysis","text":"","category":"section"},{"location":"examples_conjugate/","page":"Examples: Conjugate Models","title":"Examples: Conjugate Models","text":"# Choose the underlying data generating distributions\ndatagendists = [Bernoulli(0.2), Bernoulli(0.25)]\n\n# Choose the parameters of the simulation\n# Number of observations in each group in each step\nonestepsizes = [1000, 1000]\n\n# Maximum number of steps \nmaxsteps = 30\n\n# Minimum number of steps to run the simulation before \n# we apply the stopping rule\nminsteps = 5\n\n# Setup the experiment with models and stopping rule\nmodelA = ConjugateBernoulli(1, 1)\nmodelB = ConjugateBernoulli(1, 1)\nstoppingrule = ProbabilityBeatAllThresh(0.99)\nexperiment = ExperimentAB([modelA, modelB], stoppingrule)\n\n# Setup the simulation\nsimulation = Simulation(\n    experiment=experiment,\n    datagendists=datagendists,\n    maxsteps=maxsteps,\n    onestepsizes=[10000, 10000],\n    minsteps=minsteps\n)\n\n# Run the simulation\nnumsteps, winners, _ = runsequential(\n    simulation, numsamples=1000, numsims=50)\n\n# Calculate the number of winning times for model B (\"variant 1\")\nsum(winners .== \"variant 1\") ==  2 ","category":"page"},{"location":"api/#Conjugate-Models","page":"API","title":"Conjugate Models","text":"","category":"section"},{"location":"api/","page":"API","title":"API","text":"ProbabilisticModel\nConjugateModel\nConjugateBernoulli\nConjugateExponential\nConjugateNormal\nConjugateLogNormal\nChainedModel","category":"page"},{"location":"api/#BayesianExperiments.ProbabilisticModel","page":"API","title":"BayesianExperiments.ProbabilisticModel","text":"ProbabilisticModel\n\nProbabilisticModel is a a model of the parameters that we are interested in. The model is defined by its prior distribution and likelihood function.\n\n\n\n\n\n","category":"type"},{"location":"api/#BayesianExperiments.ConjugateModel","page":"API","title":"BayesianExperiments.ConjugateModel","text":"ConjugateModel <: ProbabilisticModel\n\nConjugateModel is a ProbabilisticModel with a conjugate prior of the  corresponding likelihood function.\n\n\n\n\n\n","category":"type"},{"location":"api/#BayesianExperiments.ConjugateBernoulli","page":"API","title":"BayesianExperiments.ConjugateBernoulli","text":"ConjugateBernoulli <: ConjugateModel\n\nBernoulli likelihood with Beta distribution as the conjugate prior.\n\nConjugateBernoulli(α, β)              # construct a ConjugateBernoulli\n\nupdate!(model, stats)             # update model with statistics from data\nsamplepost(model, numsamples)    # sampling from the posterior distribution\nsamplestats(model, numsamples)   # sampling statistics from the data generating distribution\n\n\n\n\n\n","category":"type"},{"location":"api/#BayesianExperiments.ConjugateExponential","page":"API","title":"BayesianExperiments.ConjugateExponential","text":"ConjugateExponential <: ConjugateModel\n\nExponential likelihood with Gamma distribution as the conjugate prior.\n\nConjugateExponential(α, β)            # construct a ConjugateExponential\n\nupdate!(model, stats)             # update model with statistics from data\nsamplepost(model, numsamples)    # sampling from the posterior distribution\nsamplestats(model, numsamples)   # sampling statistics from the data generating distribution\n\n\n\n\n\n","category":"type"},{"location":"api/#BayesianExperiments.ConjugateNormal","page":"API","title":"BayesianExperiments.ConjugateNormal","text":"ConjugateNormal <: ConjugateModel\n\nNormal likelihood and Normal Inverse Gamma distribution as the  conjugate prior.\n\nParameters\n\nμ: mean of normal distribution\nv:  scale variance of Normal \nα:  shape of Gamma distribution\nθ:  scale of Gamma distribution\n\nConjugateNormal(μ, v, α, θ)           # construct a ConjugateNormal\n\nupdate!(model, stats)             # update model with statistics from data\nsamplepost(model, numsamples)    # sampling from the posterior distribution\nsamplestats(model, numsamples)   # sampling statistics from the data generating distribution\n\nReferences\n\nThe update rule for Normal distribution is based on this  lecture notes.\n\n\n\n\n\n","category":"type"},{"location":"api/#BayesianExperiments.ConjugateLogNormal","page":"API","title":"BayesianExperiments.ConjugateLogNormal","text":"ConjugateLogNormal(μ, v, α, θ)\n\nA model with Normal likelihood and Normal Inverse distribution with log transformed data. Notice LogNormal in Distributions.jl takes mean and standard deviation of log(x)  instead of x as the input parameters.\n\nConjugateLogNormal(μ, v, α, θ) # construct a ConjugateLogNormal\n\nlognormalparams(μ_logx, σ²_logx) # convert normal parameters to log-normal parameters\nupdate!(model, stats)              # update model with statistics from data\nsamplepost(model, numsamples)     # sampling from the posterior distribution\nsamplestats(model, numsamples)    # sampling statistics from the data generating distributio\n\n\n\n\n\n","category":"type"},{"location":"api/#BayesianExperiments.ChainedModel","page":"API","title":"BayesianExperiments.ChainedModel","text":"ChainedModel <: ProbabilisticModel\n\nChainedModel is a combination of ConjugateModels chained by the specified operator. It can be used to model a multiple step process.\n\n\n\n\n\n","category":"type"},{"location":"api/#Bayes-Factor-Models","page":"API","title":"Bayes Factor Models","text":"","category":"section"},{"location":"api/","page":"API","title":"API","text":"NormalEffectSize\nStudentTEffectSize","category":"page"},{"location":"api/#BayesianExperiments.NormalEffectSize","page":"API","title":"BayesianExperiments.NormalEffectSize","text":"NormalEffectSize <: EffectSizeModel\n\nA standard effect size model has two hypotheses: H_0(null) an H_1(alternative):\n\nH_0: mu = m_0\nH_1: mu  m_0\n\nwith the population mean mu and pre-specified standard deviation sigma. We want to test whether  mu is equal to mu_0 or not.\n\nThe prior of the standard effect size is \n\ndelta  H_1 sim textNormal(0 sigma_0^2)\n\nwhere delta is the standard effect size. When sigma_0 = 1the prior is called  unit-information prior.  \n\nThe standard effect size delta is defined as \n\ndelta = fracmu - mu_0sigma\n\nIn practice, the standard deviations are unknown but in large sample scenario we assume  they are known and use their estimates.\n\nFileds\n\nμ0: mean of null hypothesis.\nσ0: The prior standard deviation of the effect size.\np0: prior belief of H_0. This is used to calculate the prior odds. Default 05.\n\nMethods\n\nbayesfactor(model, stats)    # calculate Bayes factor from one group statistics\nbayesfactor(model, twostats) # calculate Bayes factor from two group's statistics\n\nReferences\n\nChapter 5 hypothesis Testing with Normal Populations  in An Introduction to Bayesian Thinking.\nDeng, Alex, Jiannan Lu, and Shouyuan Chen. \"Continuous monitoring of A/B tests without pain:  Optional stopping in Bayesian testing.\" 2016 IEEE international conference on data science  and advanced analytics (DSAA). IEEE, 2016.\n\n\n\n\n\n","category":"type"},{"location":"api/#BayesianExperiments.StudentTEffectSize","page":"API","title":"BayesianExperiments.StudentTEffectSize","text":"StudentTEffectSize <: BayesFactorModel\n\nA model with Bayes factor from the Student's t distributions. We have a standard effect size model has two hypotheses: H_0(null) an H_1(alternative):\n\nH_0: mu = m_0\nH_1: mu  m_0\n\nThe model uses the Jeffreys-Zellener-Siow (JZS) prior. More specifically, we use a Cauchy prior on mu for H_1\n\nmu  sigma^2 sim textCauchy(0 r^2 sigma^2)\n\nand a Jeffrey's prior on sigma:\n\np(sigma^2) propto frac1sigma2\n\nfor both H_0 and H_1.\n\nFields\n\nr: Prior standard deviation of the effect size. \nrtol: Numerical tolerence fo the quadgk function used in the denominator calculation.\np0: prior belief of H_0. This is used to calculate the prior odds. Default 05.\n\nReferences\n\nRouder, J. N., Speckman, P. L., Sun, D., Morey, R. D., & Iverson, G. (2009). Bayesian t tests  for accepting and rejecting the null hypothesis. Psychonomic bulletin & review, 16(2), 225-237.\n\n\n\n\n\n","category":"type"},{"location":"api/#Stopping-Rules","page":"API","title":"Stopping Rules","text":"","category":"section"},{"location":"api/","page":"API","title":"API","text":"ExpectedLossThresh\nProbabilityBeatAllThresh\nOneSidedBFThresh\nTwoSidedBFThresh","category":"page"},{"location":"api/#BayesianExperiments.ExpectedLossThresh","page":"API","title":"BayesianExperiments.ExpectedLossThresh","text":"ExpectedLossThresh <: StoppingRule\n\nThe experiment has a winning model if the model has the smallest posterior expected loss,  and its expected loss value is below the threshold.\n\nReferences\n\nDefinition of the expected loss on Wikipedia\n\n\n\n\n\n","category":"type"},{"location":"api/#BayesianExperiments.ProbabilityBeatAllThresh","page":"API","title":"BayesianExperiments.ProbabilityBeatAllThresh","text":"ProbabilityBeatAllThresh <: StoppingRule\n\nThe experiment has a winning model if probability of that model's posterior samples  is larger than the alternative models is above the threshold.\n\n\n\n\n\n","category":"type"},{"location":"api/#BayesianExperiments.OneSidedBFThresh","page":"API","title":"BayesianExperiments.OneSidedBFThresh","text":"OneSidedBFThresh <: BayesFactorThresh\n\nThe bayes factor itself is interpretable as the comparative evidence of data  under the two competing hypotheses. Higher bayes factor, as defined textBF_10 favours the alternative hypothesis. \n\nIn practice, a threshold can be used to make decision in bayes factor experiment. The experiment will stop when textBF_10 > threshold.\n\nIn this case, the bayes factor of alternative over null is above the threshold, we can accept the alternative hypothesis. Otherwise, we don't  have enough evidence to accept alternative hypotheses.\n\n\n\n\n\n","category":"type"},{"location":"api/#BayesianExperiments.TwoSidedBFThresh","page":"API","title":"BayesianExperiments.TwoSidedBFThresh","text":"TwoSidedBFThresh <: BayesFactorThresh\n\nThe bayes factor itself is interpretable as the comparative evidence of data  under the two competing hypotheses. Higher bayes factor, as defined textBF_10 favours the alternative hypothesis. \n\nIn practice, a threshold can be used to make decision in bayes factor experiment. The experiment will stop when \n\ntextBF_10 > threshold\ntextBF_10 < 1/threshold\n\nIn (1), the bayes factor of alternative over null is above the threshold, we can accept the alternative hypothesis. In (2), the bayes factor is below the inverse of the threshold, we can accept the null hypothesis. Otherwise, we don't  have enough evidence to accept any of these hypotheses.\n\n\n\n\n\n","category":"type"},{"location":"api/#Experiment","page":"API","title":"Experiment","text":"","category":"section"},{"location":"api/","page":"API","title":"API","text":"Experiment\nExperimentABN\nExperimentAB\nExperimentBF","category":"page"},{"location":"api/#BayesianExperiments.Experiment","page":"API","title":"BayesianExperiments.Experiment","text":"Experiment\n\nAn experiment has the models to compare, a stopping rule to make decision. \n\n\n\n\n\n","category":"type"},{"location":"api/#BayesianExperiments.ExperimentABN","page":"API","title":"BayesianExperiments.ExperimentABN","text":"ExperimentABN{T,n} <: Experiment\n\nAn experiment with stopping rule of type T and n models. Models must have the same ProbabilisticModel type.\n\n\n\n\n\n","category":"type"},{"location":"api/#BayesianExperiments.ExperimentAB","page":"API","title":"BayesianExperiments.ExperimentAB","text":"ExperimentAB(models, rule; modelnames=nothing) where T <: StoppingRule\n\nAn experiment of ExperimentABN with two models.\n\n\n\n\n\n","category":"function"},{"location":"api/#BayesianExperiments.ExperimentBF","page":"API","title":"BayesianExperiments.ExperimentBF","text":"ExperimentBF{M} <: Experiment\n\nExperimentBF is an experiment using a Bayes Factor between the  null and alternative hypothesis as the stopping rule.\n\nConstructors\n\nExperimentBF(kwargs...)\n\nKeywords\n\nmodel::M: Prior of effect size of alternative hypothesis \np0::Float64: Probablity of null hypothesis\nwinner::Union{String, Nothing: Decision to reject the null hypothesis or not\nrule::BayesFactorThresh: Stopping rule using Bayes Factor as the threshold\nstats: Statistics for calculating the bayes factor. Default is nothing.\nmodelnames: Names of the hypotheses. Default is [\"null\", \"alternative\"].\n\n\n\n\n\n","category":"type"},{"location":"api/#Simulation","page":"API","title":"Simulation","text":"","category":"section"},{"location":"api/","page":"API","title":"API","text":"Simulation","category":"page"},{"location":"api/#BayesianExperiments.Simulation","page":"API","title":"BayesianExperiments.Simulation","text":"Simulation(experiment, parameters, datagendists, maxsteps, onestepsizes, minsteps)\n\nA simulation setup includes the experiment, data generating distributions, max number of steps and minimum number of steps.\n\n\n\n\n\n","category":"type"},{"location":"tutorials/type_s_error/#Type-S-Error-in-Fixed-Horizon-and-Sequential-Testing-Experiment","page":"Type S Error in Fixed Horizon and Sequential Testing Experiment","title":"Type S Error in Fixed Horizon and Sequential Testing Experiment","text":"","category":"section"},{"location":"tutorials/type_s_error/","page":"Type S Error in Fixed Horizon and Sequential Testing Experiment","title":"Type S Error in Fixed Horizon and Sequential Testing Experiment","text":"A Type S error is an error of sign when our claimed sign of parameter is to the opposite of the truth. See detailed discussion in this blog article and paper.","category":"page"},{"location":"tutorials/type_s_error/","page":"Type S Error in Fixed Horizon and Sequential Testing Experiment","title":"Type S Error in Fixed Horizon and Sequential Testing Experiment","text":"This example is taken from the post Is Bayesian A/B Testing Immune to Peeking? Not Exactly, which discusses about the impact of experiment design, fixed horizon or sequential design, on the Type S error rate.","category":"page"},{"location":"tutorials/type_s_error/","page":"Type S Error in Fixed Horizon and Sequential Testing Experiment","title":"Type S Error in Fixed Horizon and Sequential Testing Experiment","text":"using Random\nusing Plots\n\nusing BayesianExperiments","category":"page"},{"location":"tutorials/type_s_error/","page":"Type S Error in Fixed Horizon and Sequential Testing Experiment","title":"Type S Error in Fixed Horizon and Sequential Testing Experiment","text":"Suppose we have one new feature and we want to compare it to the old one. And the new feature will actually decrease our clickthrough rate from 01 to 09. We can use two Bernoulli distributions to represent the data generating processes.","category":"page"},{"location":"tutorials/type_s_error/","page":"Type S Error in Fixed Horizon and Sequential Testing Experiment","title":"Type S Error in Fixed Horizon and Sequential Testing Experiment","text":"θ1 = 0.0010\nθ2 = 0.0009\ndatagendistA = Bernoulli(θ1)\ndatagendistB = Bernoulli(θ2)\ndatagendists = [datagendistA, datagendistB];","category":"page"},{"location":"tutorials/type_s_error/","page":"Type S Error in Fixed Horizon and Sequential Testing Experiment","title":"Type S Error in Fixed Horizon and Sequential Testing Experiment","text":"We start our model with priors α=10 and β=90.","category":"page"},{"location":"tutorials/type_s_error/","page":"Type S Error in Fixed Horizon and Sequential Testing Experiment","title":"Type S Error in Fixed Horizon and Sequential Testing Experiment","text":"α = 10\nβ = 90\nmodelA = ConjugateBernoulli(α, β)\nmodelB = ConjugateBernoulli(α, β)\nmodels = [modelA, modelB]\nmodelnames = [\"old\", \"new\"];","category":"page"},{"location":"tutorials/type_s_error/","page":"Type S Error in Fixed Horizon and Sequential Testing Experiment","title":"Type S Error in Fixed Horizon and Sequential Testing Experiment","text":"We want to use \"expected loss\" as the key metric for our decision, and a \"threshold of caring\" of 0.00001 as the stopping rule of our experiment.","category":"page"},{"location":"tutorials/type_s_error/","page":"Type S Error in Fixed Horizon and Sequential Testing Experiment","title":"Type S Error in Fixed Horizon and Sequential Testing Experiment","text":"thresh = 0.00001\nstoppingrule = ExpectedLossThresh(thresh);","category":"page"},{"location":"tutorials/type_s_error/","page":"Type S Error in Fixed Horizon and Sequential Testing Experiment","title":"Type S Error in Fixed Horizon and Sequential Testing Experiment","text":"Now we can setup the experiment. ","category":"page"},{"location":"tutorials/type_s_error/","page":"Type S Error in Fixed Horizon and Sequential Testing Experiment","title":"Type S Error in Fixed Horizon and Sequential Testing Experiment","text":"experiment = ExperimentAB(models, stoppingrule, modelnames=modelnames);","category":"page"},{"location":"tutorials/type_s_error/#Fixed-Horizon","page":"Type S Error in Fixed Horizon and Sequential Testing Experiment","title":"Fixed Horizon","text":"","category":"section"},{"location":"tutorials/type_s_error/","page":"Type S Error in Fixed Horizon and Sequential Testing Experiment","title":"Type S Error in Fixed Horizon and Sequential Testing Experiment","text":"We can run simulation to analyze how will this experiment perform in reality.  For the first simulation, we want to use a fixed horizon that  we only see the result once after 20 days, and make decision at that point.","category":"page"},{"location":"tutorials/type_s_error/","page":"Type S Error in Fixed Horizon and Sequential Testing Experiment","title":"Type S Error in Fixed Horizon and Sequential Testing Experiment","text":"simulation_fix = Simulation(\n    experiment=experiment,\n    datagendists=datagendists,\n    maxsteps=20,\n    onestepsizes=[10000, 10000],\n    minsteps=20\n)\n\nRandom.seed!(123)\nnumsteps, winners, metricvals = runsequential(simulation_fix, numsamples=10000, numsims=100)\nprintln(\"Ratio of new variant wins:\", sum(winners .== \"new\") / 100)","category":"page"},{"location":"tutorials/type_s_error/","page":"Type S Error in Fixed Horizon and Sequential Testing Experiment","title":"Type S Error in Fixed Horizon and Sequential Testing Experiment","text":"Ratio of new variant wins:0.02","category":"page"},{"location":"tutorials/type_s_error/#Sequential-Experiment","page":"Type S Error in Fixed Horizon and Sequential Testing Experiment","title":"Sequential Experiment","text":"","category":"section"},{"location":"tutorials/type_s_error/","page":"Type S Error in Fixed Horizon and Sequential Testing Experiment","title":"Type S Error in Fixed Horizon and Sequential Testing Experiment","text":"For the second simulation, we want to use sequential decision that  we will check the result at the end of each day","category":"page"},{"location":"tutorials/type_s_error/","page":"Type S Error in Fixed Horizon and Sequential Testing Experiment","title":"Type S Error in Fixed Horizon and Sequential Testing Experiment","text":"simulation_sequential = Simulation(\n    experiment=experiment,\n    datagendists=datagendists,\n    maxsteps=20,\n    onestepsizes=[10000, 10000],\n    minsteps=1\n)\n\nRandom.seed!(124)\nnumsteps, winners, metricvals = runsequential(simulation_sequential, numsamples=10000, numsims=100)\ntype_s_error_rate = sum(winners .== \"new\") / 100\nprintln(\"Ratio of new variant wins:\", type_s_error_rate)","category":"page"},{"location":"tutorials/type_s_error/","page":"Type S Error in Fixed Horizon and Sequential Testing Experiment","title":"Type S Error in Fixed Horizon and Sequential Testing Experiment","text":"Ratio of new variant wins:0.11","category":"page"},{"location":"tutorials/type_s_error/#Expected-Loss-Thresholds-vs.-Resulting-Loss","page":"Type S Error in Fixed Horizon and Sequential Testing Experiment","title":"Expected Loss Thresholds vs. Resulting Loss","text":"","category":"section"},{"location":"tutorials/type_s_error/","page":"Type S Error in Fixed Horizon and Sequential Testing Experiment","title":"Type S Error in Fixed Horizon and Sequential Testing Experiment","text":"thresholds = [collect(range(1e-6, 9e-6, length=5)); collect(range(1.1e-5, 1e-4, length=5))];","category":"page"},{"location":"tutorials/type_s_error/","page":"Type S Error in Fixed Horizon and Sequential Testing Experiment","title":"Type S Error in Fixed Horizon and Sequential Testing Experiment","text":"α = 100\nβ = 99900\nmodelA = ConjugateBernoulli(α, β)\nmodelB = ConjugateBernoulli(α, β)\nmodels = [modelA, modelB]\nmodelnames = [\"old\", \"new\"];","category":"page"},{"location":"tutorials/type_s_error/","page":"Type S Error in Fixed Horizon and Sequential Testing Experiment","title":"Type S Error in Fixed Horizon and Sequential Testing Experiment","text":"resulting_losses_fixed = Float64[]\ntype_s_error_rates_fixed = Float64[]\n\nnumsims = 200\nRandom.seed!(12)\nfor thresh in thresholds\n    stoppingrule = ExpectedLossThresh(thresh)\n    experiment = ExperimentAB(models, stoppingrule, modelnames=modelnames)\n    simulation = Simulation(\n        experiment=experiment,\n        datagendists=datagendists,\n        maxsteps=20,\n        onestepsizes=[10000, 10000],\n        minsteps=20\n    )\n    numsteps, winners, metricvals = runsequential(simulation, numsamples=5000, numsims=numsims)\n    type_s_error_rate = sum(winners .== \"new\") / numsims\n    resulting_loss = (θ1 - θ2)*type_s_error_rate\n    push!(type_s_error_rates_fixed, type_s_error_rate)\n    push!(resulting_losses_fixed, resulting_loss)\n    @show thresh, resulting_loss, type_s_error_rate, thresh > resulting_loss\nend","category":"page"},{"location":"tutorials/type_s_error/","page":"Type S Error in Fixed Horizon and Sequential Testing Experiment","title":"Type S Error in Fixed Horizon and Sequential Testing Experiment","text":"(thresh, resulting_loss, type_s_error_rate, thresh > resulting_loss) = (1.0e-6, 0.0, 0.0, true)\n(thresh, resulting_loss, type_s_error_rate, thresh > resulting_loss) = (3.0e-6, 5.000000000000002e-7, 0.005, true)\n(thresh, resulting_loss, type_s_error_rate, thresh > resulting_loss) = (5.0e-6, 5.000000000000002e-7, 0.005, true)\n(thresh, resulting_loss, type_s_error_rate, thresh > resulting_loss) = (7.0e-6, 2.0000000000000008e-6, 0.02, true)\n(thresh, resulting_loss, type_s_error_rate, thresh > resulting_loss) = (9.0e-6, 1.0000000000000004e-6, 0.01, true)\n(thresh, resulting_loss, type_s_error_rate, thresh > resulting_loss) = (1.1e-5, 2.0000000000000008e-6, 0.02, true)\n(thresh, resulting_loss, type_s_error_rate, thresh > resulting_loss) = (3.325e-5, 1.700000000000001e-5, 0.17, true)\n(thresh, resulting_loss, type_s_error_rate, thresh > resulting_loss) = (5.55e-5, 1.4000000000000008e-5, 0.14, true)\n(thresh, resulting_loss, type_s_error_rate, thresh > resulting_loss) = (7.775e-5, 1.4500000000000005e-5, 0.145, true)\n(thresh, resulting_loss, type_s_error_rate, thresh > resulting_loss) = (0.0001, 1.4000000000000008e-5, 0.14, true)","category":"page"},{"location":"tutorials/type_s_error/","page":"Type S Error in Fixed Horizon and Sequential Testing Experiment","title":"Type S Error in Fixed Horizon and Sequential Testing Experiment","text":"resulting_losses_sequential = Float64[]\ntype_s_error_rates_sequential = Float64[]\n\nnumsims=200\nRandom.seed!(12)\nfor thresh in thresholds\n    stoppingrule = ExpectedLossThresh(thresh)\n    experiment = ExperimentAB(models, stoppingrule, modelnames=modelnames)\n    simulation = Simulation(\n        experiment=experiment,\n        datagendists=datagendists,\n        maxsteps=20,\n        onestepsizes=[10000, 10000],\n        minsteps=1\n    )\n    numsteps, winners, metricvals = runsequential(simulation, numsamples=4000, numsims=numsims)\n    type_s_error_rate = sum(winners .== \"new\") / numsims\n    resulting_loss = (θ1 - θ2)*type_s_error_rate\n    push!(type_s_error_rates_sequential, type_s_error_rate)\n    push!(resulting_losses_sequential, resulting_loss)\n    @show thresh, resulting_loss, type_s_error_rate, thresh > resulting_loss\nend","category":"page"},{"location":"tutorials/type_s_error/","page":"Type S Error in Fixed Horizon and Sequential Testing Experiment","title":"Type S Error in Fixed Horizon and Sequential Testing Experiment","text":"(thresh, resulting_loss, type_s_error_rate, thresh > resulting_loss) = (1.0e-6, 0.0, 0.0, true)\n(thresh, resulting_loss, type_s_error_rate, thresh > resulting_loss) = (3.0e-6, 1.0000000000000004e-6, 0.01, true)\n(thresh, resulting_loss, type_s_error_rate, thresh > resulting_loss) = (5.0e-6, 1.0000000000000004e-6, 0.01, true)\n(thresh, resulting_loss, type_s_error_rate, thresh > resulting_loss) = (7.0e-6, 3.500000000000002e-6, 0.035, true)\n(thresh, resulting_loss, type_s_error_rate, thresh > resulting_loss) = (9.0e-6, 5.000000000000003e-6, 0.05, true)\n(thresh, resulting_loss, type_s_error_rate, thresh > resulting_loss) = (1.1e-5, 6.500000000000003e-6, 0.065, true)\n(thresh, resulting_loss, type_s_error_rate, thresh > resulting_loss) = (3.325e-5, 2.8500000000000012e-5, 0.285, true)\n(thresh, resulting_loss, type_s_error_rate, thresh > resulting_loss) = (5.55e-5, 4.600000000000002e-5, 0.46, true)\n(thresh, resulting_loss, type_s_error_rate, thresh > resulting_loss) = (7.775e-5, 4.300000000000002e-5, 0.43, true)\n(thresh, resulting_loss, type_s_error_rate, thresh > resulting_loss) = (0.0001, 4.050000000000002e-5, 0.405, true)","category":"page"},{"location":"tutorials/type_s_error/","page":"Type S Error in Fixed Horizon and Sequential Testing Experiment","title":"Type S Error in Fixed Horizon and Sequential Testing Experiment","text":"From the plot below we can find the resulting loss is always below the threshold set in our stopping rule.","category":"page"},{"location":"tutorials/type_s_error/","page":"Type S Error in Fixed Horizon and Sequential Testing Experiment","title":"Type S Error in Fixed Horizon and Sequential Testing Experiment","text":"#Adding a small number to 0's to support log-scale plots.\nmask = resulting_losses_fixed .== 0.0\nresulting_losses_fixed[mask]  .= 1e-9\nmask = resulting_losses_sequential .== 0.0\nresulting_losses_sequential[mask]  .= 1e-9\n\nplot(thresholds, \n    [thresholds, resulting_losses_fixed, resulting_losses_sequential], \n    xaxis=:log, \n    yaxis=:log, \n    title=\"Resulting Loss vs. Expected Loss Threshold\",\n    label=[\"Expected Loss Thresh\" \"Resulting Loss (Fixed)\" \"Resulting Loss (Sequential)\"],\n    legend=:topleft, \n    xlabel=\"Threshold of expected loss\",\n    xguidefontsize=10\n)","category":"page"},{"location":"tutorials/type_s_error/","page":"Type S Error in Fixed Horizon and Sequential Testing Experiment","title":"Type S Error in Fixed Horizon and Sequential Testing Experiment","text":"(Image: svg)","category":"page"},{"location":"tutorials/type_s_error/","page":"Type S Error in Fixed Horizon and Sequential Testing Experiment","title":"Type S Error in Fixed Horizon and Sequential Testing Experiment","text":"The Type S error in the sequential experiment is more sensitive to the threshold we chose. As you can see from the plot below, the Type S error increases rapidly when the threshold gets bigger.","category":"page"},{"location":"tutorials/type_s_error/","page":"Type S Error in Fixed Horizon and Sequential Testing Experiment","title":"Type S Error in Fixed Horizon and Sequential Testing Experiment","text":"plot(thresholds, \n    [type_s_error_rates_fixed, type_s_error_rates_sequential], \n    title=\"Type S Error Rates\",\n    label=[\"Fixed\" \"Sequential\"],\n    legend=:topleft,\n    xticks=thresholds[5:end],\n    xlabel=\"Threshold of expected loss\",\n    xguidefontsize=10\n)","category":"page"},{"location":"tutorials/type_s_error/","page":"Type S Error in Fixed Horizon and Sequential Testing Experiment","title":"Type S Error in Fixed Horizon and Sequential Testing Experiment","text":"(Image: svg)","category":"page"},{"location":"tutorials/sequential_testing_conjugate_models/#Sequential-Testing-Experiment-with-Conjugate-Models","page":"Sequential Testing Experiment with Conjugate Models","title":"Sequential Testing Experiment with Conjugate Models","text":"","category":"section"},{"location":"tutorials/sequential_testing_conjugate_models/","page":"Sequential Testing Experiment with Conjugate Models","title":"Sequential Testing Experiment with Conjugate Models","text":"using Random \nusing Plots\n\nusing BayesianExperiments","category":"page"},{"location":"tutorials/sequential_testing_conjugate_models/#Two-Models","page":"Sequential Testing Experiment with Conjugate Models","title":"Two Models","text":"","category":"section"},{"location":"tutorials/sequential_testing_conjugate_models/","page":"Sequential Testing Experiment with Conjugate Models","title":"Sequential Testing Experiment with Conjugate Models","text":"We want to compare two variants with ratios. For example, we have a new UI design and want to compare its CTR (click-through-rate) to the CTR of the existing design. In this case we can create two Bernoulli models to model the CTR's of each variant. ","category":"page"},{"location":"tutorials/sequential_testing_conjugate_models/","page":"Sequential Testing Experiment with Conjugate Models","title":"Sequential Testing Experiment with Conjugate Models","text":"A Bernoulli model is a model with Bernoulli distribution as the likelihood and Beta distribution as the prior. In the beginning, we set alpha=10 and beta=90 as parameters of the prior. (We will talk about the impact of priors and how to choose a \"proper\" prior for you experiment in details later).","category":"page"},{"location":"tutorials/sequential_testing_conjugate_models/","page":"Sequential Testing Experiment with Conjugate Models","title":"Sequential Testing Experiment with Conjugate Models","text":"α = 1\nβ = 1\nmodelA = ConjugateBernoulli(α, β)\nmodelB = ConjugateBernoulli(α, β)\nmodels = [modelA, modelB]\nmodelnames = [\"control\", \"variant 1\"];","category":"page"},{"location":"tutorials/sequential_testing_conjugate_models/","page":"Sequential Testing Experiment with Conjugate Models","title":"Sequential Testing Experiment with Conjugate Models","text":"We want to use \"expected loss\" as the key metric for our decision, and a \"threshold of caring\" of 0.0001 as the stopping rule of our experiment. An expected loss can be think as the \"average\" loss that we will get if our decision is wrong. It depends on how likely our decision is wrong, and how much loss we will get when our decision is wrong.","category":"page"},{"location":"tutorials/sequential_testing_conjugate_models/","page":"Sequential Testing Experiment with Conjugate Models","title":"Sequential Testing Experiment with Conjugate Models","text":"thresh = 1e-4\nstoppingrule = ExpectedLossThresh(thresh);","category":"page"},{"location":"tutorials/sequential_testing_conjugate_models/","page":"Sequential Testing Experiment with Conjugate Models","title":"Sequential Testing Experiment with Conjugate Models","text":"An experiment is a combination of underlying models and the stopping rule that we chose before.","category":"page"},{"location":"tutorials/sequential_testing_conjugate_models/","page":"Sequential Testing Experiment with Conjugate Models","title":"Sequential Testing Experiment with Conjugate Models","text":"experiment = ExperimentAB(models, stoppingrule, modelnames=modelnames);","category":"page"},{"location":"tutorials/sequential_testing_conjugate_models/","page":"Sequential Testing Experiment with Conjugate Models","title":"Sequential Testing Experiment with Conjugate Models","text":"Now we start to collect real data in our online experiment. Let's make some assumptions to demonstrate the idea:","category":"page"},{"location":"tutorials/sequential_testing_conjugate_models/","page":"Sequential Testing Experiment with Conjugate Models","title":"Sequential Testing Experiment with Conjugate Models","text":"The underlying data generating distributions follow Bernoulli distributions with parameters 0.01 and 0.0102. And That means our new design has 2% higher CTR than the current one.\nWe use 20 of the total traffic to test the new design. At each day, we can collect 4000 and 1000 observations for \"control\" and \"variant 1\". ","category":"page"},{"location":"tutorials/sequential_testing_conjugate_models/","page":"Sequential Testing Experiment with Conjugate Models","title":"Sequential Testing Experiment with Conjugate Models","text":"We will update the models as we collect more data and monitor the change of our expected loss. Our rule is quite simple: if the expected loss of one group is below the threshold, we can stop the experiment and make decision. And we will collect for maximum 15 days and declare no winner if there is no group with expected loss below the threshold.","category":"page"},{"location":"tutorials/sequential_testing_conjugate_models/","page":"Sequential Testing Experiment with Conjugate Models","title":"Sequential Testing Experiment with Conjugate Models","text":"max_days = 15\n\nRandom.seed!(12)\nexpected_losses = Vector{Float64}[]\nday = 0\nfor _ = 1:max_days\n    day += 1\n    # we collect data every day\n    dataA = rand(Bernoulli(0.0100), 4000)\n    dataB = rand(Bernoulli(0.0102), 1000)\n    \n    # convert data into statistics\n    statsA = BernoulliStatistics(dataA)\n    statsB = BernoulliStatistics(dataB)\n    \n    # update the models in the experiment with the statistics\n    update!(experiment, [statsA, statsB])\n    \n    # calculate the metrics (expected loss)\n    # this step is optional, for visualization below\n    _, losses = metrics(experiment)\n    push!(expected_losses, losses)\n    \n    # select winner, get \"nothing\" if there is no winner\n    winner = decide!(experiment)\n    \n    # stop the experiment if we already find a winner\n    if winner !== nothing\n        break\n    end\nend","category":"page"},{"location":"tutorials/sequential_testing_conjugate_models/","page":"Sequential Testing Experiment with Conjugate Models","title":"Sequential Testing Experiment with Conjugate Models","text":"Now we can visualize the expected losses over days. We can see the expected loss of \"variant 1\" is decreasing over days. And at day 7 we find its expected loss is below the threshold in our stopping rule.","category":"page"},{"location":"tutorials/sequential_testing_conjugate_models/","page":"Sequential Testing Experiment with Conjugate Models","title":"Sequential Testing Experiment with Conjugate Models","text":"plot(collect(1:day), catbyrow(expected_losses), \n    title=\"Expected Losses\",\n    label=[\"Control\" \"Variant 1\"],\n    legend=:topleft,)\nhline!([thresh], color=:grey, line=:dash, label=:none)\nannotate!(1.5, 0.0002, text(\"Threshold\", 10))","category":"page"},{"location":"tutorials/sequential_testing_conjugate_models/","page":"Sequential Testing Experiment with Conjugate Models","title":"Sequential Testing Experiment with Conjugate Models","text":"(Image: svg)","category":"page"},{"location":"#BayesianExperiments.jl","page":"Home","title":"BayesianExperiments.jl","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"This is the documentation of BayesianExperiments.jl, a library for conducting Bayesian AB testing in Julia.","category":"page"},{"location":"","page":"Home","title":"Home","text":"Current features include:","category":"page"},{"location":"","page":"Home","title":"Home","text":"Hypothesis testing with Bayes factor. Support the effect size model with Normal distribution prior and JZS prior.\nBayesian decision making with conjugate prior models. Support expected loss and probability to beat all as the stopping rule.\nFlexible experiment design for both fixed horizon experiments and sequential test experiment.\nEfficient simulation tools to support power analysis and sensitivity analysis.","category":"page"},{"location":"#Installation","page":"Home","title":"Installation","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"You can install a stable version of BayesianExperiments by running the command in the Julia REPL:","category":"page"},{"location":"","page":"Home","title":"Home","text":"julia> ] add BayesianExperiments","category":"page"},{"location":"#Contributing","page":"Home","title":"Contributing","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"We welcome contributions to this project and discussion about its contents. Please open an issue or pull request on this repository to propose a change.","category":"page"},{"location":"#Quick-Start","page":"Home","title":"Quick Start","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"Here's a simple example showing how to use the package:","category":"page"},{"location":"","page":"Home","title":"Home","text":"using BayesianExperiments\n\n# Generate sample data\nn = 1000\ndataA = rand(Bernoulli(0.15), n)\ndataB = rand(Bernoulli(0.16), n)\n\n# Define the models\nmodelA = ConjugateBernoulli(1, 1)\nmodelB = ConjugateBernoulli(1, 1)\n\n# Choose the stopping rule that we will use for making decision\nstoppingrule = ExpectedLossThresh(0.0002)\n\n# Setup the experiment by specifying models and the stopping rule\nexperiment = ExperimentAB([modelA, modelB], stoppingrule)\n\n# Calculate the statistics from our sample data\nstatsA = BernoulliStatistics(dataA)\nstatsB = BernoulliStatistics(dataB)\n\n# Update the models in the experiment with the newly created statistics\nupdate!(experiment, [statsA, statsB])\n\n# Calculate the metric (expected loss in this case) of each model \nwinner_index, expected_losses = metrics(experiment)","category":"page"},{"location":"tutorials/bayes_factor_optional_stopping/#Bayes-Factor-Experiment-with-Optional-Stopping","page":"Bayes Factor Experiment with Optional Stopping","title":"Bayes Factor Experiment with Optional Stopping","text":"","category":"section"},{"location":"tutorials/bayes_factor_optional_stopping/","page":"Bayes Factor Experiment with Optional Stopping","title":"Bayes Factor Experiment with Optional Stopping","text":"using ProgressMeter: @showprogress\nusing DataFrames\n\nusing Plots\nusing Random\nusing BayesianExperiments\n\n# number of columns in a dataframe to show \nENV[\"COLUMNS\"] = 200;","category":"page"},{"location":"tutorials/bayes_factor_optional_stopping/","page":"Bayes Factor Experiment with Optional Stopping","title":"Bayes Factor Experiment with Optional Stopping","text":"Optional stopping refers to the practice of peeking at data and make decision whether or not to continue an experiment. Such practice is usually prohibited in the frequentist AB testing framework. By using simulation-based result, Rouder (2014)[2] showed that a Bayes factor experiment with optional stopping can be valid with proper interpretation of the Bayesian quantities. ","category":"page"},{"location":"tutorials/bayes_factor_optional_stopping/","page":"Bayes Factor Experiment with Optional Stopping","title":"Bayes Factor Experiment with Optional Stopping","text":"This notebook follows the examples in Schönbrodt et al. (2016)[1] to conduct the error analysis of Bayes factor based experiment with optional stopping.","category":"page"},{"location":"tutorials/bayes_factor_optional_stopping/","page":"Bayes Factor Experiment with Optional Stopping","title":"Bayes Factor Experiment with Optional Stopping","text":"The simulation will be conducted by following steps:","category":"page"},{"location":"tutorials/bayes_factor_optional_stopping/","page":"Bayes Factor Experiment with Optional Stopping","title":"Bayes Factor Experiment with Optional Stopping","text":"Choose a threshold of Bayes factor for decision making. For example, if the threshold is set to 10, when a Bayes factor of textBF_10 is larger than 10, or less than 1/10, we decide we have collected enough evidence and stop the experiment.\nChoose a prior distribituion for the effect size under H_1. We will use the StudentTEffectSize model in the package. You can check the definition of NormalEffectSize model from the docstring by typing ?NormalEffectSize.\nRun a minimum number of steps (20 as the same in the paper), increase the sample size. Compute the bayes factor at each step.\nAs soon as the bayes factor value reached or exceeded the one of the thresholds as set in (1), or the maximum number of steps is reached, we will stop the experiment.","category":"page"},{"location":"tutorials/bayes_factor_optional_stopping/","page":"Bayes Factor Experiment with Optional Stopping","title":"Bayes Factor Experiment with Optional Stopping","text":"Some constants used in the simulation:","category":"page"},{"location":"tutorials/bayes_factor_optional_stopping/","page":"Bayes Factor Experiment with Optional Stopping","title":"Bayes Factor Experiment with Optional Stopping","text":"Number of simulations: 5000\nMinimum number of steps: 20","category":"page"},{"location":"tutorials/bayes_factor_optional_stopping/","page":"Bayes Factor Experiment with Optional Stopping","title":"Bayes Factor Experiment with Optional Stopping","text":"The simulation function can be quickly created based on our package:","category":"page"},{"location":"tutorials/bayes_factor_optional_stopping/","page":"Bayes Factor Experiment with Optional Stopping","title":"Bayes Factor Experiment with Optional Stopping","text":"function simulate(δ, n, σ0; r=0.707, thresh=9, minsample=20)\n    # we will use two-sided decision rule for bayes factor\n    rule = TwoSidedBFThresh(thresh)\n    \n    # the prior distribution of effect size,\n    # r is the standard deviation\n    model = StudentTEffectSize(r=r)\n    \n    # setup the experiment\n    experiment = ExperimentBF(model=model, rule=rule)\n    \n    # create a sample with size n, the effect size is \n    # specified as δ\n    xs = rand(Normal(δ, 1), n)\n    \n    i = 0\n    # specify the stopping condition\n    while (i < n) & (experiment.winner === nothing)\n        i += 1\n        \n        # if minimum number of sample is not reached, \n        # keep collecting data\n        if i < minsample\n            continue\n        end\n        \n        stats = NormalStatistics(xs[1:i])\n        experiment.stats = stats\n        decide!(experiment)\n    end\n    experiment\nend\n","category":"page"},{"location":"tutorials/bayes_factor_optional_stopping/","page":"Bayes Factor Experiment with Optional Stopping","title":"Bayes Factor Experiment with Optional Stopping","text":"simulate (generic function with 1 method)","category":"page"},{"location":"tutorials/bayes_factor_optional_stopping/#Case-when-alternative-\\delta-0","page":"Bayes Factor Experiment with Optional Stopping","title":"Case when alternative delta = 0","text":"","category":"section"},{"location":"tutorials/bayes_factor_optional_stopping/","page":"Bayes Factor Experiment with Optional Stopping","title":"Bayes Factor Experiment with Optional Stopping","text":"When alternative delta  0, the error rate relates to the false positive rate. ","category":"page"},{"location":"tutorials/bayes_factor_optional_stopping/","page":"Bayes Factor Experiment with Optional Stopping","title":"Bayes Factor Experiment with Optional Stopping","text":"#deltas = collect(range(0, 1.5, step=0.2));\ndelta = 0.0\nrs = [0.707, 1.0, 1.414];\nthreshs = [3, 5, 7, 10];\ntotalnum = length(rs)*length(threshs);\n\nparamsgrid = reshape(collect(Base.Iterators.product(rs, threshs)), (totalnum, 1));\nparamsgrid = [(r=r, thresh=thresh) for (r, thresh) in paramsgrid];\n@show length(paramsgrid);","category":"page"},{"location":"tutorials/bayes_factor_optional_stopping/","page":"Bayes Factor Experiment with Optional Stopping","title":"Bayes Factor Experiment with Optional Stopping","text":"length(paramsgrid) = 12","category":"page"},{"location":"tutorials/bayes_factor_optional_stopping/","page":"Bayes Factor Experiment with Optional Stopping","title":"Bayes Factor Experiment with Optional Stopping","text":"n =  1000\nns = 5000\nminsample = 20\n\nsim_result1 = DataFrame(\n    delta=Float64[], \n    r=Float64[], \n    thresh=Float64[], \n    num_sim=Int64[], \n    num_null=Int64[], \n    num_alt=Int64[],\n    err_rate=Float64[], \n    avg_sample_size=Int64[])\n\n@showprogress for params in paramsgrid\n    delta = 0\n    r = params.r\n    thresh = params.thresh\n    winners = []\n    samplesizes = []\n    for _ in 1:ns\n        experiment = simulate(delta, n, r, thresh=thresh, minsample=minsample)\n        push!(winners, experiment.winner)\n        push!(samplesizes, experiment.stats.n)\n    end\n    \n    num_null = sum(winners .== \"null\")\n    num_alt = sum(winners .== \"alternative\")\n    \n    err_rate = num_alt/ns\n    avg_sample_size = mean(samplesizes)\n    push!(sim_result1, (delta, r, thresh, ns, num_null, num_alt, err_rate, convert(Int64, round(avg_sample_size))))\nend","category":"page"},{"location":"tutorials/bayes_factor_optional_stopping/","page":"Bayes Factor Experiment with Optional Stopping","title":"Bayes Factor Experiment with Optional Stopping","text":"\u001b[32mProgress: 100%|█████████████████████████████████████████| Time: 0:01:00\u001b[39m","category":"page"},{"location":"tutorials/bayes_factor_optional_stopping/","page":"Bayes Factor Experiment with Optional Stopping","title":"Bayes Factor Experiment with Optional Stopping","text":"sim_result1","category":"page"},{"location":"tutorials/bayes_factor_optional_stopping/","page":"Bayes Factor Experiment with Optional Stopping","title":"Bayes Factor Experiment with Optional Stopping","text":"<table class=\"data-frame\"><thead><tr><th></th><th>delta</th><th>r</th><th>thresh</th><th>numsim</th><th>numnull</th><th>numalt</th><th>errrate</th><th>avgsamplesize</th></tr><tr><th></th><th>Float64</th><th>Float64</th><th>Float64</th><th>Int64</th><th>Int64</th><th>Int64</th><th>Float64</th><th>Int64</th></tr></thead><tbody><p>12 rows × 8 columns</p><tr><th>1</th><td>0.0</td><td>0.707</td><td>3.0</td><td>5000</td><td>4666</td><td>334</td><td>0.0668</td><td>24</td></tr><tr><th>2</th><td>0.0</td><td>1.0</td><td>3.0</td><td>5000</td><td>4691</td><td>309</td><td>0.0618</td><td>24</td></tr><tr><th>3</th><td>0.0</td><td>1.414</td><td>3.0</td><td>5000</td><td>4714</td><td>286</td><td>0.0572</td><td>24</td></tr><tr><th>4</th><td>0.0</td><td>0.707</td><td>5.0</td><td>5000</td><td>4727</td><td>273</td><td>0.0546</td><td>48</td></tr><tr><th>5</th><td>0.0</td><td>1.0</td><td>5.0</td><td>5000</td><td>4743</td><td>256</td><td>0.0512</td><td>48</td></tr><tr><th>6</th><td>0.0</td><td>1.414</td><td>5.0</td><td>5000</td><td>4724</td><td>276</td><td>0.0552</td><td>47</td></tr><tr><th>7</th><td>0.0</td><td>0.707</td><td>7.0</td><td>5000</td><td>4750</td><td>244</td><td>0.0488</td><td>99</td></tr><tr><th>8</th><td>0.0</td><td>1.0</td><td>7.0</td><td>5000</td><td>4779</td><td>215</td><td>0.043</td><td>100</td></tr><tr><th>9</th><td>0.0</td><td>1.414</td><td>7.0</td><td>5000</td><td>4733</td><td>259</td><td>0.0518</td><td>102</td></tr><tr><th>10</th><td>0.0</td><td>0.707</td><td>10.0</td><td>5000</td><td>4755</td><td>181</td><td>0.0362</td><td>207</td></tr><tr><th>11</th><td>0.0</td><td>1.0</td><td>10.0</td><td>5000</td><td>4776</td><td>168</td><td>0.0336</td><td>205</td></tr><tr><th>12</th><td>0.0</td><td>1.414</td><td>10.0</td><td>5000</td><td>4746</td><td>190</td><td>0.038</td><td>208</td></tr></tbody></table>","category":"page"},{"location":"tutorials/bayes_factor_optional_stopping/#Case-when-alternative-\\delta-0-2","page":"Bayes Factor Experiment with Optional Stopping","title":"Case when alternative delta  0","text":"","category":"section"},{"location":"tutorials/bayes_factor_optional_stopping/","page":"Bayes Factor Experiment with Optional Stopping","title":"Bayes Factor Experiment with Optional Stopping","text":"We create a grid of combinations of all parameters.","category":"page"},{"location":"tutorials/bayes_factor_optional_stopping/","page":"Bayes Factor Experiment with Optional Stopping","title":"Bayes Factor Experiment with Optional Stopping","text":"deltas = collect(range(0.1, 1.0, step=0.2));\nrs = [0.707, 1.0, 1.414];\nthreshs = [3, 5, 7, 10];\ntotalnum = length(deltas)*length(rs)*length(threshs);\n\nparamsgrid = reshape(collect(Base.Iterators.product(deltas, rs, threshs)), (totalnum, 1));\nparamsgrid = [(delta=delta, r=r, thresh=thresh) for (delta, r, thresh) in paramsgrid]\n@show length(paramsgrid);\n@show paramsgrid[1:5];","category":"page"},{"location":"tutorials/bayes_factor_optional_stopping/","page":"Bayes Factor Experiment with Optional Stopping","title":"Bayes Factor Experiment with Optional Stopping","text":"length(paramsgrid) = 60\nparamsgrid[1:5] = NamedTuple{(:delta, :r, :thresh),Tuple{Float64,Float64,Int64}}[(delta = 0.1, r = 0.707, thresh = 3), (delta = 0.3, r = 0.707, thresh = 3), (delta = 0.5, r = 0.707, thresh = 3), (delta = 0.7, r = 0.707, thresh = 3), (delta = 0.9, r = 0.707, thresh = 3)]","category":"page"},{"location":"tutorials/bayes_factor_optional_stopping/","page":"Bayes Factor Experiment with Optional Stopping","title":"Bayes Factor Experiment with Optional Stopping","text":"The simulation is similar to the delta=0 case. When alternative delta  0, the error rate relates to the false negative evidence.","category":"page"},{"location":"tutorials/bayes_factor_optional_stopping/","page":"Bayes Factor Experiment with Optional Stopping","title":"Bayes Factor Experiment with Optional Stopping","text":"n =  1000\nns = 5000\nminsample = 20\n\nsim_result2 = DataFrame(\n    delta=Float64[], \n    r=Float64[], \n    thresh=Float64[], \n    num_sim=Int64[], \n    num_null=Int64[], \n    num_alt=Int64[],\n    err_rate=Float64[], \n    avg_sample_size=Int64[])\n\n@showprogress for params in paramsgrid\n    delta=params.delta\n    r = params.r\n    thresh = params.thresh\n    winners = []\n    samplesizes = []\n    for _ in 1:ns\n        experiment = simulate(delta, n, r, thresh=thresh, minsample=minsample)\n        push!(winners, experiment.winner)\n        push!(samplesizes, experiment.stats.n)\n    end\n    \n    num_null = sum(winners .== \"null\")\n    num_alt = sum(winners .== \"alternative\")\n    err_rate = 1-num_alt/ns\n    avg_sample_size = mean(samplesizes)\n    push!(sim_result2, (delta, r, thresh, ns, num_null, num_alt, \n            err_rate, convert(Int64, round(avg_sample_size))))\nend","category":"page"},{"location":"tutorials/bayes_factor_optional_stopping/","page":"Bayes Factor Experiment with Optional Stopping","title":"Bayes Factor Experiment with Optional Stopping","text":"\u001b[32mProgress: 100%|█████████████████████████████████████████| Time: 0:02:35\u001b[39m","category":"page"},{"location":"tutorials/bayes_factor_optional_stopping/","page":"Bayes Factor Experiment with Optional Stopping","title":"Bayes Factor Experiment with Optional Stopping","text":"Simulation result when delta=05","category":"page"},{"location":"tutorials/bayes_factor_optional_stopping/","page":"Bayes Factor Experiment with Optional Stopping","title":"Bayes Factor Experiment with Optional Stopping","text":"sim_result2 |>\n    df -> filter(x->x.delta==0.5, df)|>\n    df -> sort(df, [:delta, :r])","category":"page"},{"location":"tutorials/bayes_factor_optional_stopping/","page":"Bayes Factor Experiment with Optional Stopping","title":"Bayes Factor Experiment with Optional Stopping","text":"<table class=\"data-frame\"><thead><tr><th></th><th>delta</th><th>r</th><th>thresh</th><th>numsim</th><th>numnull</th><th>numalt</th><th>errrate</th><th>avgsamplesize</th></tr><tr><th></th><th>Float64</th><th>Float64</th><th>Float64</th><th>Int64</th><th>Int64</th><th>Int64</th><th>Float64</th><th>Int64</th></tr></thead><tbody><p>12 rows × 8 columns</p><tr><th>1</th><td>0.5</td><td>0.707</td><td>3.0</td><td>5000</td><td>785</td><td>4215</td><td>0.157</td><td>26</td></tr><tr><th>2</th><td>0.5</td><td>0.707</td><td>5.0</td><td>5000</td><td>86</td><td>4914</td><td>0.0172</td><td>33</td></tr><tr><th>3</th><td>0.5</td><td>0.707</td><td>7.0</td><td>5000</td><td>1</td><td>4999</td><td>0.0002</td><td>37</td></tr><tr><th>4</th><td>0.5</td><td>0.707</td><td>10.0</td><td>5000</td><td>0</td><td>5000</td><td>0.0</td><td>40</td></tr><tr><th>5</th><td>0.5</td><td>1.0</td><td>3.0</td><td>5000</td><td>731</td><td>4269</td><td>0.1462</td><td>26</td></tr><tr><th>6</th><td>0.5</td><td>1.0</td><td>5.0</td><td>5000</td><td>81</td><td>4919</td><td>0.0162</td><td>33</td></tr><tr><th>7</th><td>0.5</td><td>1.0</td><td>7.0</td><td>5000</td><td>1</td><td>4999</td><td>0.0002</td><td>36</td></tr><tr><th>8</th><td>0.5</td><td>1.0</td><td>10.0</td><td>5000</td><td>0</td><td>5000</td><td>0.0</td><td>40</td></tr><tr><th>9</th><td>0.5</td><td>1.414</td><td>3.0</td><td>5000</td><td>744</td><td>4256</td><td>0.1488</td><td>25</td></tr><tr><th>10</th><td>0.5</td><td>1.414</td><td>5.0</td><td>5000</td><td>86</td><td>4914</td><td>0.0172</td><td>34</td></tr><tr><th>11</th><td>0.5</td><td>1.414</td><td>7.0</td><td>5000</td><td>2</td><td>4998</td><td>0.0004</td><td>37</td></tr><tr><th>12</th><td>0.5</td><td>1.414</td><td>10.0</td><td>5000</td><td>0</td><td>5000</td><td>0.0</td><td>39</td></tr></tbody></table>","category":"page"},{"location":"tutorials/bayes_factor_optional_stopping/#Evaluate-the-simulation-result-with-Type-I-and-II-Error-and-FDR","page":"Bayes Factor Experiment with Optional Stopping","title":"Evaluate the simulation result with Type I & II Error and FDR","text":"","category":"section"},{"location":"tutorials/bayes_factor_optional_stopping/","page":"Bayes Factor Experiment with Optional Stopping","title":"Bayes Factor Experiment with Optional Stopping","text":"As pointed out by [2], we can evaluate the simulation result from the perspective of false discovery rate. Here we assume there is a 50-50 chance that the data is from either the null model or alternative model. ","category":"page"},{"location":"tutorials/bayes_factor_optional_stopping/","page":"Bayes Factor Experiment with Optional Stopping","title":"Bayes Factor Experiment with Optional Stopping","text":"We can merge the two simulations results by the prior standard deviation r and threshold of bayes factor. In the merged dataframe, each row represents a simulation with the 5000 samples from the null model and 5000 samples from the alternative model with the corresponding parameters (r, thresh, delta_1).","category":"page"},{"location":"tutorials/bayes_factor_optional_stopping/","page":"Bayes Factor Experiment with Optional Stopping","title":"Bayes Factor Experiment with Optional Stopping","text":"sim_result = leftjoin(sim_result1, sim_result2, \n    on=[:r, :thresh, :num_sim],\n    renamecols= \"_0\" => \"_1\"\n);\n\nsim_result.num_dis = sim_result.num_alt_0 + sim_result.num_alt_1;\nsim_result.num_false_dis = sim_result.num_alt_0;\nsim_result.fdr = sim_result.num_false_dis ./ sim_result.num_dis;\n\nsim_result.type1_error = sim_result.num_alt_0 ./ sim_result.num_sim;\n#sim_result.type2_error = 1 .- sim_result.num_alt_1 ./ sim_result.num_sim;\nsim_result.power = sim_result.num_alt_1 ./ sim_result.num_sim;\n\nsim_result = sim_result |>\n    df -> select(df, [:delta_1, :r, :thresh, :num_sim, :num_null_0, :num_alt_0, \n        :num_null_1, :num_alt_1, :type1_error, :power, :fdr]);","category":"page"},{"location":"tutorials/bayes_factor_optional_stopping/","page":"Bayes Factor Experiment with Optional Stopping","title":"Bayes Factor Experiment with Optional Stopping","text":"sim_result.num_dis = sim_result.num_alt_0 + sim_result.num_alt_1;\nsim_result.num_false_dis = sim_result.num_alt_0;\nsim_result.fdr = sim_result.num_false_dis ./ sim_result.num_dis;\n\nsim_result.type1_error = sim_result.num_alt_0 ./ sim_result.num_sim;\nsim_result.type2_error = 1 .- sim_result.num_alt_1 ./ sim_result.num_sim;","category":"page"},{"location":"tutorials/bayes_factor_optional_stopping/","page":"Bayes Factor Experiment with Optional Stopping","title":"Bayes Factor Experiment with Optional Stopping","text":"sim_result = sim_result |>\n    df -> select(df, [:delta_1, :r, :thresh, :num_sim, :num_null_0, :num_alt_0, \n        :num_null_1, :num_alt_1, :type1_error, :power, :fdr]);","category":"page"},{"location":"tutorials/bayes_factor_optional_stopping/","page":"Bayes Factor Experiment with Optional Stopping","title":"Bayes Factor Experiment with Optional Stopping","text":"Examples from merged dataframe:","category":"page"},{"location":"tutorials/bayes_factor_optional_stopping/","page":"Bayes Factor Experiment with Optional Stopping","title":"Bayes Factor Experiment with Optional Stopping","text":"sim_result |>\n    df -> filter(\n        x -> ((x.delta_1 == 0.1) .& (x.r == 0.707)) .|\n             ((x.delta_1 == 0.1) .& (x.r == 1.0)) .|\n             ((x.delta_1 == 0.3) .& (x.r == 1.0))\n            , df) |>\n    df -> sort(df, [:delta_1, :r, :thresh])","category":"page"},{"location":"tutorials/bayes_factor_optional_stopping/","page":"Bayes Factor Experiment with Optional Stopping","title":"Bayes Factor Experiment with Optional Stopping","text":"<table class=\"data-frame\"><thead><tr><th></th><th>delta1</th><th>r</th><th>thresh</th><th>numsim</th><th>numnull0</th><th>numalt0</th><th>numnull1</th><th>numalt1</th><th>type1_error</th><th>power</th><th>fdr</th></tr><tr><th></th><th>Float64?</th><th>Float64</th><th>Float64</th><th>Int64</th><th>Int64</th><th>Int64</th><th>Int64?</th><th>Int64?</th><th>Float64</th><th>Float64</th><th>Float64</th></tr></thead><tbody><p>12 rows × 11 columns</p><tr><th>1</th><td>0.1</td><td>0.707</td><td>3.0</td><td>5000</td><td>4666</td><td>334</td><td>4451</td><td>549</td><td>0.0668</td><td>0.1098</td><td>0.378256</td></tr><tr><th>2</th><td>0.1</td><td>0.707</td><td>5.0</td><td>5000</td><td>4727</td><td>273</td><td>4197</td><td>799</td><td>0.0546</td><td>0.1598</td><td>0.254664</td></tr><tr><th>3</th><td>0.1</td><td>0.707</td><td>7.0</td><td>5000</td><td>4750</td><td>244</td><td>3595</td><td>1346</td><td>0.0488</td><td>0.2692</td><td>0.153459</td></tr><tr><th>4</th><td>0.1</td><td>0.707</td><td>10.0</td><td>5000</td><td>4755</td><td>181</td><td>2533</td><td>2042</td><td>0.0362</td><td>0.4084</td><td>0.0814215</td></tr><tr><th>5</th><td>0.1</td><td>1.0</td><td>3.0</td><td>5000</td><td>4691</td><td>309</td><td>4453</td><td>547</td><td>0.0618</td><td>0.1094</td><td>0.360981</td></tr><tr><th>6</th><td>0.1</td><td>1.0</td><td>5.0</td><td>5000</td><td>4743</td><td>256</td><td>4192</td><td>807</td><td>0.0512</td><td>0.1614</td><td>0.240828</td></tr><tr><th>7</th><td>0.1</td><td>1.0</td><td>7.0</td><td>5000</td><td>4779</td><td>215</td><td>3649</td><td>1301</td><td>0.043</td><td>0.2602</td><td>0.141821</td></tr><tr><th>8</th><td>0.1</td><td>1.0</td><td>10.0</td><td>5000</td><td>4776</td><td>168</td><td>2569</td><td>2053</td><td>0.0336</td><td>0.4106</td><td>0.0756416</td></tr><tr><th>9</th><td>0.3</td><td>1.0</td><td>3.0</td><td>5000</td><td>4691</td><td>309</td><td>2584</td><td>2416</td><td>0.0618</td><td>0.4832</td><td>0.113394</td></tr><tr><th>10</th><td>0.3</td><td>1.0</td><td>5.0</td><td>5000</td><td>4743</td><td>256</td><td>1136</td><td>3864</td><td>0.0512</td><td>0.7728</td><td>0.0621359</td></tr><tr><th>11</th><td>0.3</td><td>1.0</td><td>7.0</td><td>5000</td><td>4779</td><td>215</td><td>254</td><td>4746</td><td>0.043</td><td>0.9492</td><td>0.043338</td></tr><tr><th>12</th><td>0.3</td><td>1.0</td><td>10.0</td><td>5000</td><td>4776</td><td>168</td><td>8</td><td>4992</td><td>0.0336</td><td>0.9984</td><td>0.0325581</td></tr></tbody></table>","category":"page"},{"location":"tutorials/bayes_factor_optional_stopping/#References","page":"Bayes Factor Experiment with Optional Stopping","title":"References","text":"","category":"section"},{"location":"tutorials/bayes_factor_optional_stopping/","page":"Bayes Factor Experiment with Optional Stopping","title":"Bayes Factor Experiment with Optional Stopping","text":"Schönbrodt, Felix D., Eric-Jan Wagenmakers, Michael Zehetleitner, and Marco Perugini. \"Sequential hypothesis testing with Bayes factors: Efficiently testing mean differences.\" Psychological methods 22, no. 2 (2017): 322.\nDeng, Alex, Jiannan Lu, and Shouyuan Chen. \"Continuous monitoring of A/B tests without pain: Optional stopping in Bayesian testing.\" In 2016 IEEE international conference on data science and advanced analytics (DSAA), pp. 243-252. IEEE, 2016.\nRouder, Jeffrey N. \"Optional stopping: No problem for Bayesians.\" Psychonomic bulletin & review 21, no. 2 (2014): 301-308.","category":"page"},{"location":"examples_bayesfactor/#Examples:-Bayes-Factor-Models","page":"Examples: Bayes Factor Models","title":"Examples: Bayes Factor Models","text":"","category":"section"},{"location":"examples_bayesfactor/#Example:-One-group","page":"Examples: Bayes Factor Models","title":"Example: One group","text":"","category":"section"},{"location":"examples_bayesfactor/","page":"Examples: Bayes Factor Models","title":"Examples: Bayes Factor Models","text":"This example uses the sleep data in R:","category":"page"},{"location":"examples_bayesfactor/","page":"Examples: Bayes Factor Models","title":"Examples: Bayes Factor Models","text":"# we have one group of sample\nsleepdata = [-1.2, -2.4, -1.3, -1.3, 0.0, -1.0, -1.8, -0.8, -4.6, -1.4]\n\n# calculate statistics\nnormalstats = NormalStatistics(sleepdata)\n\n# setup the prior model for the effect size\nmodel = StudentTEffectSize()\n\n# calculate the t-statistics\ntstats = StudentTStatistics(normalstats)\n\n# we can calculate the posterior odds (equal to bayes factor with\n# equal prior odds)\nbf = bayesfactor(model, stats)\n\n# we can setup the experiment after spcifying our stopping rule\nstoppingrule = TwoSidedBFThresh(9)\nexperiment = ExperimentBF(model=model, rule=stoppingrule)\n\n# update the experiment with the new data\nupdate!(experiment, normalstats)\n\n# make decision on the experiment\ndecide!(experiment)","category":"page"},{"location":"examples_bayesfactor/#Example:-Two-groups","page":"Examples: Bayes Factor Models","title":"Example: Two groups","text":"","category":"section"},{"location":"examples_bayesfactor/","page":"Examples: Bayes Factor Models","title":"Examples: Bayes Factor Models","text":"This example uses the Chicken Weights by Feed Type in R.","category":"page"},{"location":"examples_bayesfactor/","page":"Examples: Bayes Factor Models","title":"Examples: Bayes Factor Models","text":"horsebean=[179, 160, 136, 227, 217, 168, 108, 124, 143, 140]\nlinseed=[309, 229, 181, 141, 260, 203, 148, 169, 213, 257, 244, 271]\n\n# Calculate normal statistics from data in each group\nstats1 = NormalStatistics(horsebean)\nstats2 = NormalStatistics(linseed)\n\n# Here we assume equal variance\ntstat = StudentTStatistics(TwoNormalStatistics(stats1, stats2))\n\n# setup the prior model for the effect size\n# we can change the standard devation of the prior of effect size \nmodel = StudentTEffectSize(r=sqrt(2)/2)\n\n# we can calculate the posterior odds (equal to bayes factor with\n# equal prior odds)\nbf = bayesfactor(model, tstat)\n\n# we can setup the experiment after specifying our stopping rule\nstoppingrule = TwoSidedBFThresh(9)\nexperiment = ExperimentBF(model=model, rule=stoppingrule)\n\n# update the experiment with the new data\nupdate!(experiment, normalstats)\n\n# make decision on the experiment\ndecide!(experiment)","category":"page"}]
}
